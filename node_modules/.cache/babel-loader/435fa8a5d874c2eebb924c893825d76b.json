{"ast":null,"code":"var helper = require('./options-helper');\n\nvar isArray = require('./array-helper').isArray;\n\nvar currentElement, currentElementName;\n\nfunction validateOptions(userOptions) {\n  var options = helper.copyOptions(userOptions);\n  helper.ensureFlagExists('ignoreDeclaration', options);\n  helper.ensureFlagExists('ignoreInstruction', options);\n  helper.ensureFlagExists('ignoreAttributes', options);\n  helper.ensureFlagExists('ignoreText', options);\n  helper.ensureFlagExists('ignoreComment', options);\n  helper.ensureFlagExists('ignoreCdata', options);\n  helper.ensureFlagExists('ignoreDoctype', options);\n  helper.ensureFlagExists('compact', options);\n  helper.ensureFlagExists('indentText', options);\n  helper.ensureFlagExists('indentCdata', options);\n  helper.ensureFlagExists('indentAttributes', options);\n  helper.ensureFlagExists('indentInstruction', options);\n  helper.ensureFlagExists('fullTagEmptyElement', options);\n  helper.ensureFlagExists('noQuotesForNativeAttributes', options);\n  helper.ensureSpacesExists(options);\n\n  if (typeof options.spaces === 'number') {\n    options.spaces = Array(options.spaces + 1).join(' ');\n  }\n\n  helper.ensureKeyExists('declaration', options);\n  helper.ensureKeyExists('instruction', options);\n  helper.ensureKeyExists('attributes', options);\n  helper.ensureKeyExists('text', options);\n  helper.ensureKeyExists('comment', options);\n  helper.ensureKeyExists('cdata', options);\n  helper.ensureKeyExists('doctype', options);\n  helper.ensureKeyExists('type', options);\n  helper.ensureKeyExists('name', options);\n  helper.ensureKeyExists('elements', options);\n  helper.checkFnExists('doctype', options);\n  helper.checkFnExists('instruction', options);\n  helper.checkFnExists('cdata', options);\n  helper.checkFnExists('comment', options);\n  helper.checkFnExists('text', options);\n  helper.checkFnExists('instructionName', options);\n  helper.checkFnExists('elementName', options);\n  helper.checkFnExists('attributeName', options);\n  helper.checkFnExists('attributeValue', options);\n  helper.checkFnExists('attributes', options);\n  helper.checkFnExists('fullTagEmptyElement', options);\n  return options;\n}\n\nfunction writeIndentation(options, depth, firstLine) {\n  return (!firstLine && options.spaces ? '\\n' : '') + Array(depth + 1).join(options.spaces);\n}\n\nfunction writeAttributes(attributes, options, depth) {\n  if (options.ignoreAttributes) {\n    return '';\n  }\n\n  if ('attributesFn' in options) {\n    attributes = options.attributesFn(attributes, currentElementName, currentElement);\n  }\n\n  var key,\n      attr,\n      attrName,\n      quote,\n      result = [];\n\n  for (key in attributes) {\n    if (attributes.hasOwnProperty(key) && attributes[key] !== null && attributes[key] !== undefined) {\n      quote = options.noQuotesForNativeAttributes && typeof attributes[key] !== 'string' ? '' : '\"';\n      attr = '' + attributes[key]; // ensure number and boolean are converted to String\n\n      attr = attr.replace(/\"/g, '&quot;');\n      attrName = 'attributeNameFn' in options ? options.attributeNameFn(key, attr, currentElementName, currentElement) : key;\n      result.push(options.spaces && options.indentAttributes ? writeIndentation(options, depth + 1, false) : ' ');\n      result.push(attrName + '=' + quote + ('attributeValueFn' in options ? options.attributeValueFn(attr, key, currentElementName, currentElement) : attr) + quote);\n    }\n  }\n\n  if (attributes && Object.keys(attributes).length && options.spaces && options.indentAttributes) {\n    result.push(writeIndentation(options, depth, false));\n  }\n\n  return result.join('');\n}\n\nfunction writeDeclaration(declaration, options, depth) {\n  currentElement = declaration;\n  currentElementName = 'xml';\n  return options.ignoreDeclaration ? '' : '<?' + 'xml' + writeAttributes(declaration[options.attributesKey], options, depth) + '?>';\n}\n\nfunction writeInstruction(instruction, options, depth) {\n  if (options.ignoreInstruction) {\n    return '';\n  }\n\n  var key;\n\n  for (key in instruction) {\n    if (instruction.hasOwnProperty(key)) {\n      break;\n    }\n  }\n\n  var instructionName = 'instructionNameFn' in options ? options.instructionNameFn(key, instruction[key], currentElementName, currentElement) : key;\n\n  if (typeof instruction[key] === 'object') {\n    currentElement = instruction;\n    currentElementName = instructionName;\n    return '<?' + instructionName + writeAttributes(instruction[key][options.attributesKey], options, depth) + '?>';\n  } else {\n    var instructionValue = instruction[key] ? instruction[key] : '';\n    if ('instructionFn' in options) instructionValue = options.instructionFn(instructionValue, key, currentElementName, currentElement);\n    return '<?' + instructionName + (instructionValue ? ' ' + instructionValue : '') + '?>';\n  }\n}\n\nfunction writeComment(comment, options) {\n  return options.ignoreComment ? '' : '<!--' + ('commentFn' in options ? options.commentFn(comment, currentElementName, currentElement) : comment) + '-->';\n}\n\nfunction writeCdata(cdata, options) {\n  return options.ignoreCdata ? '' : '<![CDATA[' + ('cdataFn' in options ? options.cdataFn(cdata, currentElementName, currentElement) : cdata.replace(']]>', ']]]]><![CDATA[>')) + ']]>';\n}\n\nfunction writeDoctype(doctype, options) {\n  return options.ignoreDoctype ? '' : '<!DOCTYPE ' + ('doctypeFn' in options ? options.doctypeFn(doctype, currentElementName, currentElement) : doctype) + '>';\n}\n\nfunction writeText(text, options) {\n  if (options.ignoreText) return '';\n  text = '' + text; // ensure Number and Boolean are converted to String\n\n  text = text.replace(/&amp;/g, '&'); // desanitize to avoid double sanitization\n\n  text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  return 'textFn' in options ? options.textFn(text, currentElementName, currentElement) : text;\n}\n\nfunction hasContent(element, options) {\n  var i;\n\n  if (element.elements && element.elements.length) {\n    for (i = 0; i < element.elements.length; ++i) {\n      switch (element.elements[i][options.typeKey]) {\n        case 'text':\n          if (options.indentText) {\n            return true;\n          }\n\n          break;\n        // skip to next key\n\n        case 'cdata':\n          if (options.indentCdata) {\n            return true;\n          }\n\n          break;\n        // skip to next key\n\n        case 'instruction':\n          if (options.indentInstruction) {\n            return true;\n          }\n\n          break;\n        // skip to next key\n\n        case 'doctype':\n        case 'comment':\n        case 'element':\n          return true;\n\n        default:\n          return true;\n      }\n    }\n  }\n\n  return false;\n}\n\nfunction writeElement(element, options, depth) {\n  currentElement = element;\n  currentElementName = element.name;\n  var xml = [],\n      elementName = 'elementNameFn' in options ? options.elementNameFn(element.name, element) : element.name;\n  xml.push('<' + elementName);\n\n  if (element[options.attributesKey]) {\n    xml.push(writeAttributes(element[options.attributesKey], options, depth));\n  }\n\n  var withClosingTag = element[options.elementsKey] && element[options.elementsKey].length || element[options.attributesKey] && element[options.attributesKey]['xml:space'] === 'preserve';\n\n  if (!withClosingTag) {\n    if ('fullTagEmptyElementFn' in options) {\n      withClosingTag = options.fullTagEmptyElementFn(element.name, element);\n    } else {\n      withClosingTag = options.fullTagEmptyElement;\n    }\n  }\n\n  if (withClosingTag) {\n    xml.push('>');\n\n    if (element[options.elementsKey] && element[options.elementsKey].length) {\n      xml.push(writeElements(element[options.elementsKey], options, depth + 1));\n      currentElement = element;\n      currentElementName = element.name;\n    }\n\n    xml.push(options.spaces && hasContent(element, options) ? '\\n' + Array(depth + 1).join(options.spaces) : '');\n    xml.push('</' + elementName + '>');\n  } else {\n    xml.push('/>');\n  }\n\n  return xml.join('');\n}\n\nfunction writeElements(elements, options, depth, firstLine) {\n  return elements.reduce(function (xml, element) {\n    var indent = writeIndentation(options, depth, firstLine && !xml);\n\n    switch (element.type) {\n      case 'element':\n        return xml + indent + writeElement(element, options, depth);\n\n      case 'comment':\n        return xml + indent + writeComment(element[options.commentKey], options);\n\n      case 'doctype':\n        return xml + indent + writeDoctype(element[options.doctypeKey], options);\n\n      case 'cdata':\n        return xml + (options.indentCdata ? indent : '') + writeCdata(element[options.cdataKey], options);\n\n      case 'text':\n        return xml + (options.indentText ? indent : '') + writeText(element[options.textKey], options);\n\n      case 'instruction':\n        var instruction = {};\n        instruction[element[options.nameKey]] = element[options.attributesKey] ? element : element[options.instructionKey];\n        return xml + (options.indentInstruction ? indent : '') + writeInstruction(instruction, options, depth);\n    }\n  }, '');\n}\n\nfunction hasContentCompact(element, options, anyContent) {\n  var key;\n\n  for (key in element) {\n    if (element.hasOwnProperty(key)) {\n      switch (key) {\n        case options.parentKey:\n        case options.attributesKey:\n          break;\n        // skip to next key\n\n        case options.textKey:\n          if (options.indentText || anyContent) {\n            return true;\n          }\n\n          break;\n        // skip to next key\n\n        case options.cdataKey:\n          if (options.indentCdata || anyContent) {\n            return true;\n          }\n\n          break;\n        // skip to next key\n\n        case options.instructionKey:\n          if (options.indentInstruction || anyContent) {\n            return true;\n          }\n\n          break;\n        // skip to next key\n\n        case options.doctypeKey:\n        case options.commentKey:\n          return true;\n\n        default:\n          return true;\n      }\n    }\n  }\n\n  return false;\n}\n\nfunction writeElementCompact(element, name, options, depth, indent) {\n  currentElement = element;\n  currentElementName = name;\n  var elementName = 'elementNameFn' in options ? options.elementNameFn(name, element) : name;\n\n  if (typeof element === 'undefined' || element === null || element === '') {\n    return 'fullTagEmptyElementFn' in options && options.fullTagEmptyElementFn(name, element) || options.fullTagEmptyElement ? '<' + elementName + '></' + elementName + '>' : '<' + elementName + '/>';\n  }\n\n  var xml = [];\n\n  if (name) {\n    xml.push('<' + elementName);\n\n    if (typeof element !== 'object') {\n      xml.push('>' + writeText(element, options) + '</' + elementName + '>');\n      return xml.join('');\n    }\n\n    if (element[options.attributesKey]) {\n      xml.push(writeAttributes(element[options.attributesKey], options, depth));\n    }\n\n    var withClosingTag = hasContentCompact(element, options, true) || element[options.attributesKey] && element[options.attributesKey]['xml:space'] === 'preserve';\n\n    if (!withClosingTag) {\n      if ('fullTagEmptyElementFn' in options) {\n        withClosingTag = options.fullTagEmptyElementFn(name, element);\n      } else {\n        withClosingTag = options.fullTagEmptyElement;\n      }\n    }\n\n    if (withClosingTag) {\n      xml.push('>');\n    } else {\n      xml.push('/>');\n      return xml.join('');\n    }\n  }\n\n  xml.push(writeElementsCompact(element, options, depth + 1, false));\n  currentElement = element;\n  currentElementName = name;\n\n  if (name) {\n    xml.push((indent ? writeIndentation(options, depth, false) : '') + '</' + elementName + '>');\n  }\n\n  return xml.join('');\n}\n\nfunction writeElementsCompact(element, options, depth, firstLine) {\n  var i,\n      key,\n      nodes,\n      xml = [];\n\n  for (key in element) {\n    if (element.hasOwnProperty(key)) {\n      nodes = isArray(element[key]) ? element[key] : [element[key]];\n\n      for (i = 0; i < nodes.length; ++i) {\n        switch (key) {\n          case options.declarationKey:\n            xml.push(writeDeclaration(nodes[i], options, depth));\n            break;\n\n          case options.instructionKey:\n            xml.push((options.indentInstruction ? writeIndentation(options, depth, firstLine) : '') + writeInstruction(nodes[i], options, depth));\n            break;\n\n          case options.attributesKey:\n          case options.parentKey:\n            break;\n          // skip\n\n          case options.textKey:\n            xml.push((options.indentText ? writeIndentation(options, depth, firstLine) : '') + writeText(nodes[i], options));\n            break;\n\n          case options.cdataKey:\n            xml.push((options.indentCdata ? writeIndentation(options, depth, firstLine) : '') + writeCdata(nodes[i], options));\n            break;\n\n          case options.doctypeKey:\n            xml.push(writeIndentation(options, depth, firstLine) + writeDoctype(nodes[i], options));\n            break;\n\n          case options.commentKey:\n            xml.push(writeIndentation(options, depth, firstLine) + writeComment(nodes[i], options));\n            break;\n\n          default:\n            xml.push(writeIndentation(options, depth, firstLine) + writeElementCompact(nodes[i], key, options, depth, hasContentCompact(nodes[i], options)));\n        }\n\n        firstLine = firstLine && !xml.length;\n      }\n    }\n  }\n\n  return xml.join('');\n}\n\nmodule.exports = function (js, options) {\n  options = validateOptions(options);\n  var xml = [];\n  currentElement = js;\n  currentElementName = '_root_';\n\n  if (options.compact) {\n    xml.push(writeElementsCompact(js, options, 0, true));\n  } else {\n    if (js[options.declarationKey]) {\n      xml.push(writeDeclaration(js[options.declarationKey], options, 0));\n    }\n\n    if (js[options.elementsKey] && js[options.elementsKey].length) {\n      xml.push(writeElements(js[options.elementsKey], options, 0, !xml.length));\n    }\n  }\n\n  return xml.join('');\n};","map":{"version":3,"sources":["C:/eclipse/React/book-suggestion/node_modules/xml-js/lib/js2xml.js"],"names":["helper","require","isArray","currentElement","currentElementName","validateOptions","userOptions","options","copyOptions","ensureFlagExists","ensureSpacesExists","spaces","Array","join","ensureKeyExists","checkFnExists","writeIndentation","depth","firstLine","writeAttributes","attributes","ignoreAttributes","attributesFn","key","attr","attrName","quote","result","hasOwnProperty","undefined","noQuotesForNativeAttributes","replace","attributeNameFn","push","indentAttributes","attributeValueFn","Object","keys","length","writeDeclaration","declaration","ignoreDeclaration","attributesKey","writeInstruction","instruction","ignoreInstruction","instructionName","instructionNameFn","instructionValue","instructionFn","writeComment","comment","ignoreComment","commentFn","writeCdata","cdata","ignoreCdata","cdataFn","writeDoctype","doctype","ignoreDoctype","doctypeFn","writeText","text","ignoreText","textFn","hasContent","element","i","elements","typeKey","indentText","indentCdata","indentInstruction","writeElement","name","xml","elementName","elementNameFn","withClosingTag","elementsKey","fullTagEmptyElementFn","fullTagEmptyElement","writeElements","reduce","indent","type","commentKey","doctypeKey","cdataKey","textKey","nameKey","instructionKey","hasContentCompact","anyContent","parentKey","writeElementCompact","writeElementsCompact","nodes","declarationKey","module","exports","js","compact"],"mappings":"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","sourcesContent":["var helper = require('./options-helper');\nvar isArray = require('./array-helper').isArray;\n\nvar currentElement, currentElementName;\n\nfunction validateOptions(userOptions) {\n  var options = helper.copyOptions(userOptions);\n  helper.ensureFlagExists('ignoreDeclaration', options);\n  helper.ensureFlagExists('ignoreInstruction', options);\n  helper.ensureFlagExists('ignoreAttributes', options);\n  helper.ensureFlagExists('ignoreText', options);\n  helper.ensureFlagExists('ignoreComment', options);\n  helper.ensureFlagExists('ignoreCdata', options);\n  helper.ensureFlagExists('ignoreDoctype', options);\n  helper.ensureFlagExists('compact', options);\n  helper.ensureFlagExists('indentText', options);\n  helper.ensureFlagExists('indentCdata', options);\n  helper.ensureFlagExists('indentAttributes', options);\n  helper.ensureFlagExists('indentInstruction', options);\n  helper.ensureFlagExists('fullTagEmptyElement', options);\n  helper.ensureFlagExists('noQuotesForNativeAttributes', options);\n  helper.ensureSpacesExists(options);\n  if (typeof options.spaces === 'number') {\n    options.spaces = Array(options.spaces + 1).join(' ');\n  }\n  helper.ensureKeyExists('declaration', options);\n  helper.ensureKeyExists('instruction', options);\n  helper.ensureKeyExists('attributes', options);\n  helper.ensureKeyExists('text', options);\n  helper.ensureKeyExists('comment', options);\n  helper.ensureKeyExists('cdata', options);\n  helper.ensureKeyExists('doctype', options);\n  helper.ensureKeyExists('type', options);\n  helper.ensureKeyExists('name', options);\n  helper.ensureKeyExists('elements', options);\n  helper.checkFnExists('doctype', options);\n  helper.checkFnExists('instruction', options);\n  helper.checkFnExists('cdata', options);\n  helper.checkFnExists('comment', options);\n  helper.checkFnExists('text', options);\n  helper.checkFnExists('instructionName', options);\n  helper.checkFnExists('elementName', options);\n  helper.checkFnExists('attributeName', options);\n  helper.checkFnExists('attributeValue', options);\n  helper.checkFnExists('attributes', options);\n  helper.checkFnExists('fullTagEmptyElement', options);\n  return options;\n}\n\nfunction writeIndentation(options, depth, firstLine) {\n  return (!firstLine && options.spaces ? '\\n' : '') + Array(depth + 1).join(options.spaces);\n}\n\nfunction writeAttributes(attributes, options, depth) {\n  if (options.ignoreAttributes) {\n    return '';\n  }\n  if ('attributesFn' in options) {\n    attributes = options.attributesFn(attributes, currentElementName, currentElement);\n  }\n  var key, attr, attrName, quote, result = [];\n  for (key in attributes) {\n    if (attributes.hasOwnProperty(key) && attributes[key] !== null && attributes[key] !== undefined) {\n      quote = options.noQuotesForNativeAttributes && typeof attributes[key] !== 'string' ? '' : '\"';\n      attr = '' + attributes[key]; // ensure number and boolean are converted to String\n      attr = attr.replace(/\"/g, '&quot;');\n      attrName = 'attributeNameFn' in options ? options.attributeNameFn(key, attr, currentElementName, currentElement) : key;\n      result.push((options.spaces && options.indentAttributes? writeIndentation(options, depth+1, false) : ' '));\n      result.push(attrName + '=' + quote + ('attributeValueFn' in options ? options.attributeValueFn(attr, key, currentElementName, currentElement) : attr) + quote);\n    }\n  }\n  if (attributes && Object.keys(attributes).length && options.spaces && options.indentAttributes) {\n    result.push(writeIndentation(options, depth, false));\n  }\n  return result.join('');\n}\n\nfunction writeDeclaration(declaration, options, depth) {\n  currentElement = declaration;\n  currentElementName = 'xml';\n  return options.ignoreDeclaration ? '' :  '<?' + 'xml' + writeAttributes(declaration[options.attributesKey], options, depth) + '?>';\n}\n\nfunction writeInstruction(instruction, options, depth) {\n  if (options.ignoreInstruction) {\n    return '';\n  }\n  var key;\n  for (key in instruction) {\n    if (instruction.hasOwnProperty(key)) {\n      break;\n    }\n  }\n  var instructionName = 'instructionNameFn' in options ? options.instructionNameFn(key, instruction[key], currentElementName, currentElement) : key;\n  if (typeof instruction[key] === 'object') {\n    currentElement = instruction;\n    currentElementName = instructionName;\n    return '<?' + instructionName + writeAttributes(instruction[key][options.attributesKey], options, depth) + '?>';\n  } else {\n    var instructionValue = instruction[key] ? instruction[key] : '';\n    if ('instructionFn' in options) instructionValue = options.instructionFn(instructionValue, key, currentElementName, currentElement);\n    return '<?' + instructionName + (instructionValue ? ' ' + instructionValue : '') + '?>';\n  }\n}\n\nfunction writeComment(comment, options) {\n  return options.ignoreComment ? '' : '<!--' + ('commentFn' in options ? options.commentFn(comment, currentElementName, currentElement) : comment) + '-->';\n}\n\nfunction writeCdata(cdata, options) {\n  return options.ignoreCdata ? '' : '<![CDATA[' + ('cdataFn' in options ? options.cdataFn(cdata, currentElementName, currentElement) : cdata.replace(']]>', ']]]]><![CDATA[>')) + ']]>';\n}\n\nfunction writeDoctype(doctype, options) {\n  return options.ignoreDoctype ? '' : '<!DOCTYPE ' + ('doctypeFn' in options ? options.doctypeFn(doctype, currentElementName, currentElement) : doctype) + '>';\n}\n\nfunction writeText(text, options) {\n  if (options.ignoreText) return '';\n  text = '' + text; // ensure Number and Boolean are converted to String\n  text = text.replace(/&amp;/g, '&'); // desanitize to avoid double sanitization\n  text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  return 'textFn' in options ? options.textFn(text, currentElementName, currentElement) : text;\n}\n\nfunction hasContent(element, options) {\n  var i;\n  if (element.elements && element.elements.length) {\n    for (i = 0; i < element.elements.length; ++i) {\n      switch (element.elements[i][options.typeKey]) {\n      case 'text':\n        if (options.indentText) {\n          return true;\n        }\n        break; // skip to next key\n      case 'cdata':\n        if (options.indentCdata) {\n          return true;\n        }\n        break; // skip to next key\n      case 'instruction':\n        if (options.indentInstruction) {\n          return true;\n        }\n        break; // skip to next key\n      case 'doctype':\n      case 'comment':\n      case 'element':\n        return true;\n      default:\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction writeElement(element, options, depth) {\n  currentElement = element;\n  currentElementName = element.name;\n  var xml = [], elementName = 'elementNameFn' in options ? options.elementNameFn(element.name, element) : element.name;\n  xml.push('<' + elementName);\n  if (element[options.attributesKey]) {\n    xml.push(writeAttributes(element[options.attributesKey], options, depth));\n  }\n  var withClosingTag = element[options.elementsKey] && element[options.elementsKey].length || element[options.attributesKey] && element[options.attributesKey]['xml:space'] === 'preserve';\n  if (!withClosingTag) {\n    if ('fullTagEmptyElementFn' in options) {\n      withClosingTag = options.fullTagEmptyElementFn(element.name, element);\n    } else {\n      withClosingTag = options.fullTagEmptyElement;\n    }\n  }\n  if (withClosingTag) {\n    xml.push('>');\n    if (element[options.elementsKey] && element[options.elementsKey].length) {\n      xml.push(writeElements(element[options.elementsKey], options, depth + 1));\n      currentElement = element;\n      currentElementName = element.name;\n    }\n    xml.push(options.spaces && hasContent(element, options) ? '\\n' + Array(depth + 1).join(options.spaces) : '');\n    xml.push('</' + elementName + '>');\n  } else {\n    xml.push('/>');\n  }\n  return xml.join('');\n}\n\nfunction writeElements(elements, options, depth, firstLine) {\n  return elements.reduce(function (xml, element) {\n    var indent = writeIndentation(options, depth, firstLine && !xml);\n    switch (element.type) {\n    case 'element': return xml + indent + writeElement(element, options, depth);\n    case 'comment': return xml + indent + writeComment(element[options.commentKey], options);\n    case 'doctype': return xml + indent + writeDoctype(element[options.doctypeKey], options);\n    case 'cdata': return xml + (options.indentCdata ? indent : '') + writeCdata(element[options.cdataKey], options);\n    case 'text': return xml + (options.indentText ? indent : '') + writeText(element[options.textKey], options);\n    case 'instruction':\n      var instruction = {};\n      instruction[element[options.nameKey]] = element[options.attributesKey] ? element : element[options.instructionKey];\n      return xml + (options.indentInstruction ? indent : '') + writeInstruction(instruction, options, depth);\n    }\n  }, '');\n}\n\nfunction hasContentCompact(element, options, anyContent) {\n  var key;\n  for (key in element) {\n    if (element.hasOwnProperty(key)) {\n      switch (key) {\n      case options.parentKey:\n      case options.attributesKey:\n        break; // skip to next key\n      case options.textKey:\n        if (options.indentText || anyContent) {\n          return true;\n        }\n        break; // skip to next key\n      case options.cdataKey:\n        if (options.indentCdata || anyContent) {\n          return true;\n        }\n        break; // skip to next key\n      case options.instructionKey:\n        if (options.indentInstruction || anyContent) {\n          return true;\n        }\n        break; // skip to next key\n      case options.doctypeKey:\n      case options.commentKey:\n        return true;\n      default:\n        return true;\n      }\n    }\n  }\n  return false;\n}\n\nfunction writeElementCompact(element, name, options, depth, indent) {\n  currentElement = element;\n  currentElementName = name;\n  var elementName = 'elementNameFn' in options ? options.elementNameFn(name, element) : name;\n  if (typeof element === 'undefined' || element === null || element === '') {\n    return 'fullTagEmptyElementFn' in options && options.fullTagEmptyElementFn(name, element) || options.fullTagEmptyElement ? '<' + elementName + '></' + elementName + '>' : '<' + elementName + '/>';\n  }\n  var xml = [];\n  if (name) {\n    xml.push('<' + elementName);\n    if (typeof element !== 'object') {\n      xml.push('>' + writeText(element,options) + '</' + elementName + '>');\n      return xml.join('');\n    }\n    if (element[options.attributesKey]) {\n      xml.push(writeAttributes(element[options.attributesKey], options, depth));\n    }\n    var withClosingTag = hasContentCompact(element, options, true) || element[options.attributesKey] && element[options.attributesKey]['xml:space'] === 'preserve';\n    if (!withClosingTag) {\n      if ('fullTagEmptyElementFn' in options) {\n        withClosingTag = options.fullTagEmptyElementFn(name, element);\n      } else {\n        withClosingTag = options.fullTagEmptyElement;\n      }\n    }\n    if (withClosingTag) {\n      xml.push('>');\n    } else {\n      xml.push('/>');\n      return xml.join('');\n    }\n  }\n  xml.push(writeElementsCompact(element, options, depth + 1, false));\n  currentElement = element;\n  currentElementName = name;\n  if (name) {\n    xml.push((indent ? writeIndentation(options, depth, false) : '') + '</' + elementName + '>');\n  }\n  return xml.join('');\n}\n\nfunction writeElementsCompact(element, options, depth, firstLine) {\n  var i, key, nodes, xml = [];\n  for (key in element) {\n    if (element.hasOwnProperty(key)) {\n      nodes = isArray(element[key]) ? element[key] : [element[key]];\n      for (i = 0; i < nodes.length; ++i) {\n        switch (key) {\n        case options.declarationKey: xml.push(writeDeclaration(nodes[i], options, depth)); break;\n        case options.instructionKey: xml.push((options.indentInstruction ? writeIndentation(options, depth, firstLine) : '') + writeInstruction(nodes[i], options, depth)); break;\n        case options.attributesKey: case options.parentKey: break; // skip\n        case options.textKey: xml.push((options.indentText ? writeIndentation(options, depth, firstLine) : '') + writeText(nodes[i], options)); break;\n        case options.cdataKey: xml.push((options.indentCdata ? writeIndentation(options, depth, firstLine) : '') + writeCdata(nodes[i], options)); break;\n        case options.doctypeKey: xml.push(writeIndentation(options, depth, firstLine) + writeDoctype(nodes[i], options)); break;\n        case options.commentKey: xml.push(writeIndentation(options, depth, firstLine) + writeComment(nodes[i], options)); break;\n        default: xml.push(writeIndentation(options, depth, firstLine) + writeElementCompact(nodes[i], key, options, depth, hasContentCompact(nodes[i], options)));\n        }\n        firstLine = firstLine && !xml.length;\n      }\n    }\n  }\n  return xml.join('');\n}\n\nmodule.exports = function (js, options) {\n  options = validateOptions(options);\n  var xml = [];\n  currentElement = js;\n  currentElementName = '_root_';\n  if (options.compact) {\n    xml.push(writeElementsCompact(js, options, 0, true));\n  } else {\n    if (js[options.declarationKey]) {\n      xml.push(writeDeclaration(js[options.declarationKey], options, 0));\n    }\n    if (js[options.elementsKey] && js[options.elementsKey].length) {\n      xml.push(writeElements(js[options.elementsKey], options, 0, !xml.length));\n    }\n  }\n  return xml.join('');\n};\n"]},"metadata":{},"sourceType":"script"}