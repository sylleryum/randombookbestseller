{"ast":null,"code":"var sax = require('sax');\n\nvar expat\n/*= require('node-expat');*/\n= {\n  on: function on() {},\n  parse: function parse() {}\n};\n\nvar helper = require('./options-helper');\n\nvar isArray = require('./array-helper').isArray;\n\nvar options;\nvar pureJsParser = true;\nvar currentElement;\n\nfunction validateOptions(userOptions) {\n  options = helper.copyOptions(userOptions);\n  helper.ensureFlagExists('ignoreDeclaration', options);\n  helper.ensureFlagExists('ignoreInstruction', options);\n  helper.ensureFlagExists('ignoreAttributes', options);\n  helper.ensureFlagExists('ignoreText', options);\n  helper.ensureFlagExists('ignoreComment', options);\n  helper.ensureFlagExists('ignoreCdata', options);\n  helper.ensureFlagExists('ignoreDoctype', options);\n  helper.ensureFlagExists('compact', options);\n  helper.ensureFlagExists('alwaysChildren', options);\n  helper.ensureFlagExists('addParent', options);\n  helper.ensureFlagExists('trim', options);\n  helper.ensureFlagExists('nativeType', options);\n  helper.ensureFlagExists('nativeTypeAttributes', options);\n  helper.ensureFlagExists('sanitize', options);\n  helper.ensureFlagExists('instructionHasAttributes', options);\n  helper.ensureFlagExists('captureSpacesBetweenElements', options);\n  helper.ensureAlwaysArrayExists(options);\n  helper.ensureKeyExists('declaration', options);\n  helper.ensureKeyExists('instruction', options);\n  helper.ensureKeyExists('attributes', options);\n  helper.ensureKeyExists('text', options);\n  helper.ensureKeyExists('comment', options);\n  helper.ensureKeyExists('cdata', options);\n  helper.ensureKeyExists('doctype', options);\n  helper.ensureKeyExists('type', options);\n  helper.ensureKeyExists('name', options);\n  helper.ensureKeyExists('elements', options);\n  helper.ensureKeyExists('parent', options);\n  helper.checkFnExists('doctype', options);\n  helper.checkFnExists('instruction', options);\n  helper.checkFnExists('cdata', options);\n  helper.checkFnExists('comment', options);\n  helper.checkFnExists('text', options);\n  helper.checkFnExists('instructionName', options);\n  helper.checkFnExists('elementName', options);\n  helper.checkFnExists('attributeName', options);\n  helper.checkFnExists('attributeValue', options);\n  helper.checkFnExists('attributes', options);\n  return options;\n}\n\nfunction nativeType(value) {\n  var nValue = Number(value);\n\n  if (!isNaN(nValue)) {\n    return nValue;\n  }\n\n  var bValue = value.toLowerCase();\n\n  if (bValue === 'true') {\n    return true;\n  } else if (bValue === 'false') {\n    return false;\n  }\n\n  return value;\n}\n\nfunction addField(type, value) {\n  var key;\n\n  if (options.compact) {\n    if (!currentElement[options[type + 'Key']] && (isArray(options.alwaysArray) ? options.alwaysArray.indexOf(options[type + 'Key']) !== -1 : options.alwaysArray)) {\n      currentElement[options[type + 'Key']] = [];\n    }\n\n    if (currentElement[options[type + 'Key']] && !isArray(currentElement[options[type + 'Key']])) {\n      currentElement[options[type + 'Key']] = [currentElement[options[type + 'Key']]];\n    }\n\n    if (type + 'Fn' in options && typeof value === 'string') {\n      value = options[type + 'Fn'](value, currentElement);\n    }\n\n    if (type === 'instruction' && ('instructionFn' in options || 'instructionNameFn' in options)) {\n      for (key in value) {\n        if (value.hasOwnProperty(key)) {\n          if ('instructionFn' in options) {\n            value[key] = options.instructionFn(value[key], key, currentElement);\n          } else {\n            var temp = value[key];\n            delete value[key];\n            value[options.instructionNameFn(key, temp, currentElement)] = temp;\n          }\n        }\n      }\n    }\n\n    if (isArray(currentElement[options[type + 'Key']])) {\n      currentElement[options[type + 'Key']].push(value);\n    } else {\n      currentElement[options[type + 'Key']] = value;\n    }\n  } else {\n    if (!currentElement[options.elementsKey]) {\n      currentElement[options.elementsKey] = [];\n    }\n\n    var element = {};\n    element[options.typeKey] = type;\n\n    if (type === 'instruction') {\n      for (key in value) {\n        if (value.hasOwnProperty(key)) {\n          break;\n        }\n      }\n\n      element[options.nameKey] = 'instructionNameFn' in options ? options.instructionNameFn(key, value, currentElement) : key;\n\n      if (options.instructionHasAttributes) {\n        element[options.attributesKey] = value[key][options.attributesKey];\n\n        if ('instructionFn' in options) {\n          element[options.attributesKey] = options.instructionFn(element[options.attributesKey], key, currentElement);\n        }\n      } else {\n        if ('instructionFn' in options) {\n          value[key] = options.instructionFn(value[key], key, currentElement);\n        }\n\n        element[options.instructionKey] = value[key];\n      }\n    } else {\n      if (type + 'Fn' in options) {\n        value = options[type + 'Fn'](value, currentElement);\n      }\n\n      element[options[type + 'Key']] = value;\n    }\n\n    if (options.addParent) {\n      element[options.parentKey] = currentElement;\n    }\n\n    currentElement[options.elementsKey].push(element);\n  }\n}\n\nfunction manipulateAttributes(attributes) {\n  if ('attributesFn' in options && attributes) {\n    attributes = options.attributesFn(attributes, currentElement);\n  }\n\n  if ((options.trim || 'attributeValueFn' in options || 'attributeNameFn' in options || options.nativeTypeAttributes) && attributes) {\n    var key;\n\n    for (key in attributes) {\n      if (attributes.hasOwnProperty(key)) {\n        if (options.trim) attributes[key] = attributes[key].trim();\n\n        if (options.nativeTypeAttributes) {\n          attributes[key] = nativeType(attributes[key]);\n        }\n\n        if ('attributeValueFn' in options) attributes[key] = options.attributeValueFn(attributes[key], key, currentElement);\n\n        if ('attributeNameFn' in options) {\n          var temp = attributes[key];\n          delete attributes[key];\n          attributes[options.attributeNameFn(key, attributes[key], currentElement)] = temp;\n        }\n      }\n    }\n  }\n\n  return attributes;\n}\n\nfunction onInstruction(instruction) {\n  var attributes = {};\n\n  if (instruction.body && (instruction.name.toLowerCase() === 'xml' || options.instructionHasAttributes)) {\n    var attrsRegExp = /([\\w:-]+)\\s*=\\s*(?:\"([^\"]*)\"|'([^']*)'|(\\w+))\\s*/g;\n    var match;\n\n    while ((match = attrsRegExp.exec(instruction.body)) !== null) {\n      attributes[match[1]] = match[2] || match[3] || match[4];\n    }\n\n    attributes = manipulateAttributes(attributes);\n  }\n\n  if (instruction.name.toLowerCase() === 'xml') {\n    if (options.ignoreDeclaration) {\n      return;\n    }\n\n    currentElement[options.declarationKey] = {};\n\n    if (Object.keys(attributes).length) {\n      currentElement[options.declarationKey][options.attributesKey] = attributes;\n    }\n\n    if (options.addParent) {\n      currentElement[options.declarationKey][options.parentKey] = currentElement;\n    }\n  } else {\n    if (options.ignoreInstruction) {\n      return;\n    }\n\n    if (options.trim) {\n      instruction.body = instruction.body.trim();\n    }\n\n    var value = {};\n\n    if (options.instructionHasAttributes && Object.keys(attributes).length) {\n      value[instruction.name] = {};\n      value[instruction.name][options.attributesKey] = attributes;\n    } else {\n      value[instruction.name] = instruction.body;\n    }\n\n    addField('instruction', value);\n  }\n}\n\nfunction onStartElement(name, attributes) {\n  var element;\n\n  if (typeof name === 'object') {\n    attributes = name.attributes;\n    name = name.name;\n  }\n\n  attributes = manipulateAttributes(attributes);\n\n  if ('elementNameFn' in options) {\n    name = options.elementNameFn(name, currentElement);\n  }\n\n  if (options.compact) {\n    element = {};\n\n    if (!options.ignoreAttributes && attributes && Object.keys(attributes).length) {\n      element[options.attributesKey] = {};\n      var key;\n\n      for (key in attributes) {\n        if (attributes.hasOwnProperty(key)) {\n          element[options.attributesKey][key] = attributes[key];\n        }\n      }\n    }\n\n    if (!(name in currentElement) && (isArray(options.alwaysArray) ? options.alwaysArray.indexOf(name) !== -1 : options.alwaysArray)) {\n      currentElement[name] = [];\n    }\n\n    if (currentElement[name] && !isArray(currentElement[name])) {\n      currentElement[name] = [currentElement[name]];\n    }\n\n    if (isArray(currentElement[name])) {\n      currentElement[name].push(element);\n    } else {\n      currentElement[name] = element;\n    }\n  } else {\n    if (!currentElement[options.elementsKey]) {\n      currentElement[options.elementsKey] = [];\n    }\n\n    element = {};\n    element[options.typeKey] = 'element';\n    element[options.nameKey] = name;\n\n    if (!options.ignoreAttributes && attributes && Object.keys(attributes).length) {\n      element[options.attributesKey] = attributes;\n    }\n\n    if (options.alwaysChildren) {\n      element[options.elementsKey] = [];\n    }\n\n    currentElement[options.elementsKey].push(element);\n  }\n\n  element[options.parentKey] = currentElement; // will be deleted in onEndElement() if !options.addParent\n\n  currentElement = element;\n}\n\nfunction onText(text) {\n  if (options.ignoreText) {\n    return;\n  }\n\n  if (!text.trim() && !options.captureSpacesBetweenElements) {\n    return;\n  }\n\n  if (options.trim) {\n    text = text.trim();\n  }\n\n  if (options.nativeType) {\n    text = nativeType(text);\n  }\n\n  if (options.sanitize) {\n    text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\n  }\n\n  addField('text', text);\n}\n\nfunction onComment(comment) {\n  if (options.ignoreComment) {\n    return;\n  }\n\n  if (options.trim) {\n    comment = comment.trim();\n  }\n\n  addField('comment', comment);\n}\n\nfunction onEndElement(name) {\n  var parentElement = currentElement[options.parentKey];\n\n  if (!options.addParent) {\n    delete currentElement[options.parentKey];\n  }\n\n  currentElement = parentElement;\n}\n\nfunction onCdata(cdata) {\n  if (options.ignoreCdata) {\n    return;\n  }\n\n  if (options.trim) {\n    cdata = cdata.trim();\n  }\n\n  addField('cdata', cdata);\n}\n\nfunction onDoctype(doctype) {\n  if (options.ignoreDoctype) {\n    return;\n  }\n\n  doctype = doctype.replace(/^ /, '');\n\n  if (options.trim) {\n    doctype = doctype.trim();\n  }\n\n  addField('doctype', doctype);\n}\n\nfunction onError(error) {\n  error.note = error; //console.error(error);\n}\n\nmodule.exports = function (xml, userOptions) {\n  var parser = pureJsParser ? sax.parser(true, {}) : parser = new expat.Parser('UTF-8');\n  var result = {};\n  currentElement = result;\n  options = validateOptions(userOptions);\n\n  if (pureJsParser) {\n    parser.opt = {\n      strictEntities: true\n    };\n    parser.onopentag = onStartElement;\n    parser.ontext = onText;\n    parser.oncomment = onComment;\n    parser.onclosetag = onEndElement;\n    parser.onerror = onError;\n    parser.oncdata = onCdata;\n    parser.ondoctype = onDoctype;\n    parser.onprocessinginstruction = onInstruction;\n  } else {\n    parser.on('startElement', onStartElement);\n    parser.on('text', onText);\n    parser.on('comment', onComment);\n    parser.on('endElement', onEndElement);\n    parser.on('error', onError); //parser.on('startCdata', onStartCdata);\n    //parser.on('endCdata', onEndCdata);\n    //parser.on('entityDecl', onEntityDecl);\n  }\n\n  if (pureJsParser) {\n    parser.write(xml).close();\n  } else {\n    if (!parser.parse(xml)) {\n      throw new Error('XML parsing error: ' + parser.getError());\n    }\n  }\n\n  if (result[options.elementsKey]) {\n    var temp = result[options.elementsKey];\n    delete result[options.elementsKey];\n    result[options.elementsKey] = temp;\n    delete result.text;\n  }\n\n  return result;\n};","map":{"version":3,"sources":["C:/Eclipse/React/book-suggestion/node_modules/xml-js/lib/xml2js.js"],"names":["sax","require","expat","on","parse","helper","isArray","options","pureJsParser","currentElement","validateOptions","userOptions","copyOptions","ensureFlagExists","ensureAlwaysArrayExists","ensureKeyExists","checkFnExists","nativeType","value","nValue","Number","isNaN","bValue","toLowerCase","addField","type","key","compact","alwaysArray","indexOf","hasOwnProperty","instructionFn","temp","instructionNameFn","push","elementsKey","element","typeKey","nameKey","instructionHasAttributes","attributesKey","instructionKey","addParent","parentKey","manipulateAttributes","attributes","attributesFn","trim","nativeTypeAttributes","attributeValueFn","attributeNameFn","onInstruction","instruction","body","name","attrsRegExp","match","exec","ignoreDeclaration","declarationKey","Object","keys","length","ignoreInstruction","onStartElement","elementNameFn","ignoreAttributes","alwaysChildren","onText","text","ignoreText","captureSpacesBetweenElements","sanitize","replace","onComment","comment","ignoreComment","onEndElement","parentElement","onCdata","cdata","ignoreCdata","onDoctype","doctype","ignoreDoctype","onError","error","note","module","exports","xml","parser","Parser","result","opt","strictEntities","onopentag","ontext","oncomment","onclosetag","onerror","oncdata","ondoctype","onprocessinginstruction","write","close","Error","getError"],"mappings":"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","sourcesContent":["var sax = require('sax');\r\nvar expat /*= require('node-expat');*/ = { on: function () { }, parse: function () { } };\r\nvar helper = require('./options-helper');\r\nvar isArray = require('./array-helper').isArray;\r\n\r\nvar options;\r\nvar pureJsParser = true;\r\nvar currentElement;\r\n\r\nfunction validateOptions(userOptions) {\r\n  options = helper.copyOptions(userOptions);\r\n  helper.ensureFlagExists('ignoreDeclaration', options);\r\n  helper.ensureFlagExists('ignoreInstruction', options);\r\n  helper.ensureFlagExists('ignoreAttributes', options);\r\n  helper.ensureFlagExists('ignoreText', options);\r\n  helper.ensureFlagExists('ignoreComment', options);\r\n  helper.ensureFlagExists('ignoreCdata', options);\r\n  helper.ensureFlagExists('ignoreDoctype', options);\r\n  helper.ensureFlagExists('compact', options);\r\n  helper.ensureFlagExists('alwaysChildren', options);\r\n  helper.ensureFlagExists('addParent', options);\r\n  helper.ensureFlagExists('trim', options);\r\n  helper.ensureFlagExists('nativeType', options);\r\n  helper.ensureFlagExists('nativeTypeAttributes', options);\r\n  helper.ensureFlagExists('sanitize', options);\r\n  helper.ensureFlagExists('instructionHasAttributes', options);\r\n  helper.ensureFlagExists('captureSpacesBetweenElements', options);\r\n  helper.ensureAlwaysArrayExists(options);\r\n  helper.ensureKeyExists('declaration', options);\r\n  helper.ensureKeyExists('instruction', options);\r\n  helper.ensureKeyExists('attributes', options);\r\n  helper.ensureKeyExists('text', options);\r\n  helper.ensureKeyExists('comment', options);\r\n  helper.ensureKeyExists('cdata', options);\r\n  helper.ensureKeyExists('doctype', options);\r\n  helper.ensureKeyExists('type', options);\r\n  helper.ensureKeyExists('name', options);\r\n  helper.ensureKeyExists('elements', options);\r\n  helper.ensureKeyExists('parent', options);\r\n  helper.checkFnExists('doctype', options);\r\n  helper.checkFnExists('instruction', options);\r\n  helper.checkFnExists('cdata', options);\r\n  helper.checkFnExists('comment', options);\r\n  helper.checkFnExists('text', options);\r\n  helper.checkFnExists('instructionName', options);\r\n  helper.checkFnExists('elementName', options);\r\n  helper.checkFnExists('attributeName', options);\r\n  helper.checkFnExists('attributeValue', options);\r\n  helper.checkFnExists('attributes', options);\r\n  return options;\r\n}\r\n\r\nfunction nativeType(value) {\r\n  var nValue = Number(value);\r\n  if (!isNaN(nValue)) {\r\n    return nValue;\r\n  }\r\n  var bValue = value.toLowerCase();\r\n  if (bValue === 'true') {\r\n    return true;\r\n  } else if (bValue === 'false') {\r\n    return false;\r\n  }\r\n  return value;\r\n}\r\n\r\nfunction addField(type, value) {\r\n  var key;\r\n  if (options.compact) {\r\n    if (\r\n      !currentElement[options[type + 'Key']] &&\r\n      (isArray(options.alwaysArray) ? options.alwaysArray.indexOf(options[type + 'Key']) !== -1 : options.alwaysArray)\r\n    ) {\r\n      currentElement[options[type + 'Key']] = [];\r\n    }\r\n    if (currentElement[options[type + 'Key']] && !isArray(currentElement[options[type + 'Key']])) {\r\n      currentElement[options[type + 'Key']] = [currentElement[options[type + 'Key']]];\r\n    }\r\n    if (type + 'Fn' in options && typeof value === 'string') {\r\n      value = options[type + 'Fn'](value, currentElement);\r\n    }\r\n    if (type === 'instruction' && ('instructionFn' in options || 'instructionNameFn' in options)) {\r\n      for (key in value) {\r\n        if (value.hasOwnProperty(key)) {\r\n          if ('instructionFn' in options) {\r\n            value[key] = options.instructionFn(value[key], key, currentElement);\r\n          } else {\r\n            var temp = value[key];\r\n            delete value[key];\r\n            value[options.instructionNameFn(key, temp, currentElement)] = temp;\r\n          }\r\n        }\r\n      }\r\n    }\r\n    if (isArray(currentElement[options[type + 'Key']])) {\r\n      currentElement[options[type + 'Key']].push(value);\r\n    } else {\r\n      currentElement[options[type + 'Key']] = value;\r\n    }\r\n  } else {\r\n    if (!currentElement[options.elementsKey]) {\r\n      currentElement[options.elementsKey] = [];\r\n    }\r\n    var element = {};\r\n    element[options.typeKey] = type;\r\n    if (type === 'instruction') {\r\n      for (key in value) {\r\n        if (value.hasOwnProperty(key)) {\r\n          break;\r\n        }\r\n      }\r\n      element[options.nameKey] = 'instructionNameFn' in options ? options.instructionNameFn(key, value, currentElement) : key;\r\n      if (options.instructionHasAttributes) {\r\n        element[options.attributesKey] = value[key][options.attributesKey];\r\n        if ('instructionFn' in options) {\r\n          element[options.attributesKey] = options.instructionFn(element[options.attributesKey], key, currentElement);\r\n        }\r\n      } else {\r\n        if ('instructionFn' in options) {\r\n          value[key] = options.instructionFn(value[key], key, currentElement);\r\n        }\r\n        element[options.instructionKey] = value[key];\r\n      }\r\n    } else {\r\n      if (type + 'Fn' in options) {\r\n        value = options[type + 'Fn'](value, currentElement);\r\n      }\r\n      element[options[type + 'Key']] = value;\r\n    }\r\n    if (options.addParent) {\r\n      element[options.parentKey] = currentElement;\r\n    }\r\n    currentElement[options.elementsKey].push(element);\r\n  }\r\n}\r\n\r\nfunction manipulateAttributes(attributes) {\r\n  if ('attributesFn' in options && attributes) {\r\n    attributes = options.attributesFn(attributes, currentElement);\r\n  }\r\n  if ((options.trim || 'attributeValueFn' in options || 'attributeNameFn' in options || options.nativeTypeAttributes) && attributes) {\r\n    var key;\r\n    for (key in attributes) {\r\n      if (attributes.hasOwnProperty(key)) {\r\n        if (options.trim) attributes[key] = attributes[key].trim();\r\n        if (options.nativeTypeAttributes) {\r\n          attributes[key] = nativeType(attributes[key]);\r\n        }\r\n        if ('attributeValueFn' in options) attributes[key] = options.attributeValueFn(attributes[key], key, currentElement);\r\n        if ('attributeNameFn' in options) {\r\n          var temp = attributes[key];\r\n          delete attributes[key];\r\n          attributes[options.attributeNameFn(key, attributes[key], currentElement)] = temp;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return attributes;\r\n}\r\n\r\nfunction onInstruction(instruction) {\r\n  var attributes = {};\r\n  if (instruction.body && (instruction.name.toLowerCase() === 'xml' || options.instructionHasAttributes)) {\r\n    var attrsRegExp = /([\\w:-]+)\\s*=\\s*(?:\"([^\"]*)\"|'([^']*)'|(\\w+))\\s*/g;\r\n    var match;\r\n    while ((match = attrsRegExp.exec(instruction.body)) !== null) {\r\n      attributes[match[1]] = match[2] || match[3] || match[4];\r\n    }\r\n    attributes = manipulateAttributes(attributes);\r\n  }\r\n  if (instruction.name.toLowerCase() === 'xml') {\r\n    if (options.ignoreDeclaration) {\r\n      return;\r\n    }\r\n    currentElement[options.declarationKey] = {};\r\n    if (Object.keys(attributes).length) {\r\n      currentElement[options.declarationKey][options.attributesKey] = attributes;\r\n    }\r\n    if (options.addParent) {\r\n      currentElement[options.declarationKey][options.parentKey] = currentElement;\r\n    }\r\n  } else {\r\n    if (options.ignoreInstruction) {\r\n      return;\r\n    }\r\n    if (options.trim) {\r\n      instruction.body = instruction.body.trim();\r\n    }\r\n    var value = {};\r\n    if (options.instructionHasAttributes && Object.keys(attributes).length) {\r\n      value[instruction.name] = {};\r\n      value[instruction.name][options.attributesKey] = attributes;\r\n    } else {\r\n      value[instruction.name] = instruction.body;\r\n    }\r\n    addField('instruction', value);\r\n  }\r\n}\r\n\r\nfunction onStartElement(name, attributes) {\r\n  var element;\r\n  if (typeof name === 'object') {\r\n    attributes = name.attributes;\r\n    name = name.name;\r\n  }\r\n  attributes = manipulateAttributes(attributes);\r\n  if ('elementNameFn' in options) {\r\n    name = options.elementNameFn(name, currentElement);\r\n  }\r\n  if (options.compact) {\r\n    element = {};\r\n    if (!options.ignoreAttributes && attributes && Object.keys(attributes).length) {\r\n      element[options.attributesKey] = {};\r\n      var key;\r\n      for (key in attributes) {\r\n        if (attributes.hasOwnProperty(key)) {\r\n          element[options.attributesKey][key] = attributes[key];\r\n        }\r\n      }\r\n    }\r\n    if (\r\n      !(name in currentElement) &&\r\n      (isArray(options.alwaysArray) ? options.alwaysArray.indexOf(name) !== -1 : options.alwaysArray)\r\n    ) {\r\n      currentElement[name] = [];\r\n    }\r\n    if (currentElement[name] && !isArray(currentElement[name])) {\r\n      currentElement[name] = [currentElement[name]];\r\n    }\r\n    if (isArray(currentElement[name])) {\r\n      currentElement[name].push(element);\r\n    } else {\r\n      currentElement[name] = element;\r\n    }\r\n  } else {\r\n    if (!currentElement[options.elementsKey]) {\r\n      currentElement[options.elementsKey] = [];\r\n    }\r\n    element = {};\r\n    element[options.typeKey] = 'element';\r\n    element[options.nameKey] = name;\r\n    if (!options.ignoreAttributes && attributes && Object.keys(attributes).length) {\r\n      element[options.attributesKey] = attributes;\r\n    }\r\n    if (options.alwaysChildren) {\r\n      element[options.elementsKey] = [];\r\n    }\r\n    currentElement[options.elementsKey].push(element);\r\n  }\r\n  element[options.parentKey] = currentElement; // will be deleted in onEndElement() if !options.addParent\r\n  currentElement = element;\r\n}\r\n\r\nfunction onText(text) {\r\n  if (options.ignoreText) {\r\n    return;\r\n  }\r\n  if (!text.trim() && !options.captureSpacesBetweenElements) {\r\n    return;\r\n  }\r\n  if (options.trim) {\r\n    text = text.trim();\r\n  }\r\n  if (options.nativeType) {\r\n    text = nativeType(text);\r\n  }\r\n  if (options.sanitize) {\r\n    text = text.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;');\r\n  }\r\n  addField('text', text);\r\n}\r\n\r\nfunction onComment(comment) {\r\n  if (options.ignoreComment) {\r\n    return;\r\n  }\r\n  if (options.trim) {\r\n    comment = comment.trim();\r\n  }\r\n  addField('comment', comment);\r\n}\r\n\r\nfunction onEndElement(name) {\r\n  var parentElement = currentElement[options.parentKey];\r\n  if (!options.addParent) {\r\n    delete currentElement[options.parentKey];\r\n  }\r\n  currentElement = parentElement;\r\n}\r\n\r\nfunction onCdata(cdata) {\r\n  if (options.ignoreCdata) {\r\n    return;\r\n  }\r\n  if (options.trim) {\r\n    cdata = cdata.trim();\r\n  }\r\n  addField('cdata', cdata);\r\n}\r\n\r\nfunction onDoctype(doctype) {\r\n  if (options.ignoreDoctype) {\r\n    return;\r\n  }\r\n  doctype = doctype.replace(/^ /, '');\r\n  if (options.trim) {\r\n    doctype = doctype.trim();\r\n  }\r\n  addField('doctype', doctype);\r\n}\r\n\r\nfunction onError(error) {\r\n  error.note = error; //console.error(error);\r\n}\r\n\r\nmodule.exports = function (xml, userOptions) {\r\n\r\n  var parser = pureJsParser ? sax.parser(true, {}) : parser = new expat.Parser('UTF-8');\r\n  var result = {};\r\n  currentElement = result;\r\n\r\n  options = validateOptions(userOptions);\r\n\r\n  if (pureJsParser) {\r\n    parser.opt = {strictEntities: true};\r\n    parser.onopentag = onStartElement;\r\n    parser.ontext = onText;\r\n    parser.oncomment = onComment;\r\n    parser.onclosetag = onEndElement;\r\n    parser.onerror = onError;\r\n    parser.oncdata = onCdata;\r\n    parser.ondoctype = onDoctype;\r\n    parser.onprocessinginstruction = onInstruction;\r\n  } else {\r\n    parser.on('startElement', onStartElement);\r\n    parser.on('text', onText);\r\n    parser.on('comment', onComment);\r\n    parser.on('endElement', onEndElement);\r\n    parser.on('error', onError);\r\n    //parser.on('startCdata', onStartCdata);\r\n    //parser.on('endCdata', onEndCdata);\r\n    //parser.on('entityDecl', onEntityDecl);\r\n  }\r\n\r\n  if (pureJsParser) {\r\n    parser.write(xml).close();\r\n  } else {\r\n    if (!parser.parse(xml)) {\r\n      throw new Error('XML parsing error: ' + parser.getError());\r\n    }\r\n  }\r\n\r\n  if (result[options.elementsKey]) {\r\n    var temp = result[options.elementsKey];\r\n    delete result[options.elementsKey];\r\n    result[options.elementsKey] = temp;\r\n    delete result.text;\r\n  }\r\n\r\n  return result;\r\n\r\n};\r\n"]},"metadata":{},"sourceType":"script"}